<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>å°ç£äººå£çµæ§‹æˆ°æƒ…å®¤ï¼šæ‰‹æ©Ÿå„ªåŒ–ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        :root {
            --primary-blue: #3498db;
            --primary-red: #e74c3c;
            --primary-purple: #9b59b6;
            --primary-yellow: #f1c40f;
            --primary-green: #2ecc71;
            --primary-brown: #d35400;
            --dark-bg: #2c3e50;
            --light-bg: #f4f6f9;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", Roboto, Arial, sans-serif;
            background-color: var(--light-bg);
            margin: 0;
            padding: 10px;
            color: #333;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        header { text-align: center; margin-bottom: 20px; }
        h1 { color: var(--dark-bg); margin: 0; font-size: clamp(1.3rem, 4vw, 2.2rem); line-height: 1.4; }
        .subtitle { color: #7f8c8d; font-size: clamp(0.85rem, 3vw, 1.1rem); margin-top: 8px; }

        /* --- æ§åˆ¶å° (æ‰‹æ©Ÿå„ªåŒ–é‡é») --- */
        .controls-panel {
            background: #fff8f0;
            border: 1px solid #ffe0b2;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .control-header {
            text-align: center;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--primary-brown);
            font-size: 0.9rem;
        }

        .button-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .toggle-btn {
            display: flex;
            align-items: center;
            justify-content: center; /* æ–‡å­—ç½®ä¸­ */
            cursor: pointer;
            padding: 8px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 30px;
            transition: all 0.2s;
            user-select: none;
            font-size: 0.9rem;
            color: #666;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ›è¡Œ */
        }

        /* æ‰‹æ©Ÿç‰ˆæ¨£å¼è¦†å¯« */
        @media (max-width: 600px) {
            .button-grid {
                display: grid; /* æ”¹ç”¨ Grid ä½ˆå±€ */
                grid-template-columns: 1fr 1fr; /* å¼·åˆ¶å…©æ¬„ï¼Œæ•´é½Šæ’åˆ— */
                gap: 8px;
            }
            .toggle-btn {
                width: 100%; /* å¡«æ»¿æ ¼å­ */
                font-size: 0.85rem;
                padding: 8px 4px;
            }
            .container { padding: 15px 10px; }
        }

        .toggle-btn:hover { background: #f1f1f1; transform: translateY(-1px); }
        .toggle-btn input { display: none; }
        .toggle-btn.active { border-color: transparent; color: white; box-shadow: 0 3px 6px rgba(0,0,0,0.15); }

        .btn-blue.active { background-color: var(--primary-blue); }
        .btn-red.active { background-color: var(--primary-red); }
        .btn-purple.active { background-color: var(--primary-purple); }
        .btn-yellow.active { background-color: #f39c12; }
        .btn-green.active { background-color: var(--primary-green); }
        .btn-brown.active { background-color: var(--primary-brown); }
        
        .indicator-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 6px; background: #ccc; border: 1px solid white; }
        .toggle-btn.active .indicator-dot { background: white; }

        /* --- æ•¸æ“šå¡ç‰‡ --- */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); /* æ‰‹æ©Ÿç‰ˆè‡ªå‹•ç¸®å°å¡ç‰‡å¯¬åº¦ */
            gap: 10px;
            margin-bottom: 20px;
        }

        .stat-card {
            padding: 15px; border-radius: 12px; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; justify-content: center; position: relative; overflow: hidden;
            min-height: 90px;
        }
        .stat-card::after { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0)); pointer-events: none; }
        .stat-card h3 { margin: 0; font-size: 0.8rem; opacity: 0.95; }
        .stat-card .value { font-size: 1.3rem; font-weight: bold; margin: 4px 0; }
        .stat-card .desc { font-size: 0.7rem; opacity: 0.9; }

        .bg-green { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .bg-brown { background: linear-gradient(135deg, #d35400, #a04000); }
        .bg-dark { background: linear-gradient(135deg, #34495e, #2c3e50); }
        .bg-red-alert { background: linear-gradient(135deg, #c0392b, #922b21); }

        /* --- åœ–è¡¨å€åŸŸ (æ‰‹æ©Ÿé«˜åº¦å„ªåŒ–) --- */
        .chart-wrapper {
            position: relative;
            width: 100%;
            height: 600px; /* é›»è…¦ç‰ˆé«˜åº¦ */
            margin-bottom: 30px;
        }

        @media (max-width: 600px) {
            .chart-wrapper {
                height: 500px; /* æ‰‹æ©Ÿç‰ˆç¨å¾®æ‹‰é«˜ï¼Œè®“å‚ç›´æ¨™ç±¤ä¸æ“æ“ ï¼Œä½†ä¸éé•· */
            }
        }

        /* è¡¨æ ¼èˆ‡èªªæ˜ */
        .table-container { width: 100%; overflow-x: auto; border-radius: 10px; border: 1px solid #eee; margin-bottom: 30px; max-height: 500px; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; min-width: 900px; }
        th { background-color: var(--dark-bg); color: white; padding: 10px; position: sticky; top: 0; z-index: 10; white-space: nowrap; }
        td { padding: 8px 6px; text-align: center; border-bottom: 1px solid #eee; white-space: nowrap; }
        .negative-val { color: #c0392b; font-weight: bold; }
        .dragon-row { background-color: #fffde7; }
        .pressure-tag { display: inline-block; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; font-weight: bold; }
        .pressure-low { background-color: #d5f5e3; color: #1e8449; }
        .pressure-mid { background-color: #fcf3cf; color: #b7950b; }
        .pressure-high { background-color: #fadbd8; color: #922b21; }

        .footer-note { background-color: #fffaf0; border-left: 5px solid var(--primary-brown); padding: 15px; border-radius: 8px; margin-top: 20px; font-size: 0.9rem; }
        .footer-title { font-weight: bold; margin-bottom: 10px; color: var(--dark-bg); }
        .definition-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 10px; }
        .def-card { background: white; padding: 12px; border-radius: 8px; border-left: 4px solid #ccc; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .def-card h5 { margin: 0 0 5px 0; font-size: 0.95rem; }
        .def-card p { margin: 0; font-size: 0.85rem; color: #666; line-height: 1.4; }
        .def-card.young { border-left-color: var(--primary-green); } .def-card.young h5 { color: var(--primary-green); }
        .def-card.old { border-left-color: var(--primary-brown); } .def-card.old h5 { color: var(--primary-brown); }
        .def-card.total { border-left-color: var(--primary-purple); } .def-card.total h5 { color: var(--primary-purple); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>å°ç£äººå£çµæ§‹æˆ°æƒ…å®¤</h1>
        <div class="subtitle">1970-2025 è€åŒ–è¶¨å‹¢äº’å‹•åœ–è§£</div>
    </header>

    <div class="controls-panel">
        <div class="control-header">â–¼ é»æ“ŠæŒ‰éˆ•åˆ‡æ›é¡¯ç¤ºæŒ‡æ¨™ â–¼</div>
        <div class="button-grid">
            <label class="toggle-btn btn-blue active">
                <input type="checkbox" checked onchange="toggleDataset(0, this)"> <span class="indicator-dot"></span> å‡ºç”Ÿäººæ•¸
            </label>
            <label class="toggle-btn btn-red active">
                <input type="checkbox" checked onchange="toggleDataset(1, this)"> <span class="indicator-dot"></span> æ­»äº¡äººæ•¸
            </label>
            <label class="toggle-btn btn-purple active">
                <input type="checkbox" checked onchange="toggleDataset(2, this)"> <span class="indicator-dot"></span> ç¸½æ‰¶é¤Šæ¯”
            </label>
            <label class="toggle-btn btn-green active">
                <input type="checkbox" checked onchange="toggleDataset(3, this)"> <span class="indicator-dot"></span> æ‰¶å¹¼æ¯”
            </label>
            <label class="toggle-btn btn-brown active">
                <input type="checkbox" checked onchange="toggleDataset(4, this)"> <span class="indicator-dot"></span> æ‰¶è€æ¯”
            </label>
            <label class="toggle-btn btn-yellow active">
                <input type="checkbox" checked onchange="toggleDataset(5, this)"> <span class="indicator-dot"></span> ç¸½äººå£
            </label>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card bg-green">
            <h3>å‹å‹•åŠ›é«˜å³° (2015)</h3>
            <div class="value">1,737 è¬</div>
            <div class="desc">å·¥ä½œäººå£é ‚é»</div>
        </div>
        <div class="stat-card bg-brown">
            <h3>çµæ§‹äº¤å‰ (2017)</h3>
            <div class="value">è€äºº > å°å­©</div>
            <div class="desc">è€åŒ–æŒ‡æ•¸ç ´ç™¾</div>
        </div>
        <div class="stat-card bg-dark">
            <h3>ç”Ÿæ­»äº¤å‰ (2020)</h3>
            <div class="value">ç”Ÿä¸å¦‚æ­»</div>
            <div class="desc">äººå£è‡ªç„¶æ¸›å°‘</div>
        </div>
        <div class="stat-card bg-red-alert">
            <h3>è¶…é«˜é½¡åŒ– (2025)</h3>
            <div class="value">20% è€äºº</div>
            <div class="desc">æ¯5äººæœ‰1è€äºº</div>
        </div>
    </div>

    <div class="chart-wrapper">
        <canvas id="mainChart"></canvas>
    </div>

    <div class="table-container">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>å¹´åº¦</th>
                    <th>å‡ºç”Ÿ</th>
                    <th>æ­»äº¡</th>
                    <th>ç¸½äººå£(è¬)</th>
                    <th>è‡ªç„¶å¢åŠ </th>
                    <th>æ‰¶å¹¼æ¯”</th>
                    <th>æ‰¶è€æ¯”</th>
                    <th>ç¸½æ‰¶é¤Šæ¯”</th>
                    <th>å£“åŠ›è§£è®€</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="footer-note">
        <div class="footer-title">ğŸ’¡ æ•¸æ“šè§£è®€å°ç™¾ç§‘</div>
        <div class="definition-grid">
            <div class="def-card young">
                <h5>ğŸ‘¶ æ‰¶å¹¼æ¯”</h5>
                <p>æ¯100å€‹å·¥ä½œäººå£éœ€è² æ“”çš„å°å­©æ•¸ã€‚æ•¸å€¼ä¸€è·¯ä¸‹æ»‘ï¼Œåæ˜ åš´é‡å°‘å­åŒ–ã€‚</p>
            </div>
            <div class="def-card old">
                <h5>ğŸ‘µ æ‰¶è€æ¯” (é—œéµ!)</h5>
                <p>æ¯100å€‹å·¥ä½œäººå£éœ€è² æ“”çš„è€äººæ•¸ã€‚<strong>Jå‹æ›²ç·šé£†å‡</strong>ï¼Œæ˜¯ç›®å‰æœ€å¤§çš„ç¤¾æœƒæŒ‘æˆ°ã€‚</p>
            </div>
            <div class="def-card total">
                <h5>ğŸ“‰ äººå£è€åŒ–ä¸‰éšæ®µ</h5>
                <p>
                    1993 é«˜é½¡åŒ–(7%) âœ 2018 é«˜é½¡(14%) âœ 2025 è¶…é«˜é½¡(20%)ã€‚<br>
                    <span style="color:#d35400;">*å°ç£åƒ…ç”¨7å¹´å°±å¾é«˜é½¡è½‰å…¥è¶…é«˜é½¡ç¤¾æœƒã€‚</span>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    Chart.register(window['chartjs-plugin-annotation']);

    // --- åˆ¤æ–·è£ç½®å¯¬åº¦ (ç”¨æ–¼å‹•æ…‹èª¿æ•´å­—é«”) ---
    const isMobile = window.innerWidth < 600;
    const fontBase = isMobile ? 10 : 12; // æ‰‹æ©Ÿç‰ˆå­—é«”ç¸®å°
    const fontBold = isMobile ? 11 : 13;

    // --- æ•¸æ“šåº« ---
    const popBenchmarks = { 1970:1467, 1975:1615, 1980:1780, 1985:1925, 1990:2035, 1995:2130, 2000:2218, 2005:2270, 2010:2316, 2015:2349, 2019:2360, 2020:2356, 2021:2337, 2022:2326, 2023:2342, 2024:2340, 2025:2310 };
    const exactDependencyData = { 1970:74.0, 1975:66.0, 1980:58.7, 1985:51.5, 1990:47.9, 1995:45.6, 2000:42.1, 2005:39.0, 2010:35.9, 2012:34.7, 2015:35.3, 2016:36.2, 2017:37.0, 2018:37.9, 2019:38.9, 2020:40.2, 2021:41.3, 2022:42.2, 2023:43.1, 2024:44.3, 2025:45.8 };
    const exactYoungDepData = { 1970:69.6, 1975:60.5, 1980:52.0, 1985:43.4, 1990:38.8, 1995:35.0, 2000:30.2, 2005:25.4, 2010:20.7, 2012:19.8, 2015:19.3, 2016:18.8, 2017:18.2, 2018:17.7, 2019:17.5, 2020:17.6, 2021:17.5, 2022:17.2, 2023:17.0, 2024:16.7, 2025:16.5 };
    const exactOldDepData = { 1970:4.4, 1975:5.5, 1980:6.7, 1985:8.1, 1990:9.1, 1995:10.6, 2000:11.9, 2005:13.6, 2010:15.2, 2012:14.9, 2015:16.0, 2016:17.4, 2017:18.8, 2018:20.2, 2019:21.4, 2020:22.6, 2021:23.8, 2022:25.0, 2023:26.1, 2024:27.6, 2025:29.3 };
    const vitalStats = [ {y:1970, b:39.4, d:10.4}, {y:1975, b:36.9, d:10.4}, {y:1976, b:42.5, d:10.6}, {y:1980, b:41.3, d:10.9}, {y:1985, b:34.6, d:11.2}, {y:1990, b:33.5, d:11.9}, {y:1995, b:32.9, d:12.6}, {y:2000, b:30.5, d:13.1}, {y:2005, b:20.5, d:13.9}, {y:2010, b:16.6, d:14.5}, {y:2012, b:22.9, d:15.4}, {y:2015, b:21.3, d:16.3}, {y:2016, b:20.8, d:17.2}, {y:2017, b:19.3, d:17.1}, {y:2018, b:18.1, d:17.2}, {y:2019, b:17.7, d:17.6}, {y:2020, b:16.5, d:17.3}, {y:2021, b:15.3, d:18.3}, {y:2022, b:13.8, d:20.7}, {y:2023, b:13.5, d:20.5}, {y:2024, b:13.4, d:20.2}, {y:2025, b:10.7, d:18.2} ];

    function interpolate(year, benchmarks) {
        if (benchmarks[year] !== undefined) return benchmarks[year];
        const keys = Object.keys(benchmarks).map(Number).sort((a,b)=>a-b);
        let prev = keys[0], next = keys[keys.length-1];
        for(let k of keys) {
            if (k <= year) prev = k;
            if (k > year) { next = k; break; }
        }
        if (prev === next) return benchmarks[prev];
        const ratio = (year - prev) / (next - prev);
        return benchmarks[prev] + ratio * (benchmarks[next] - benchmarks[prev]);
    }

    const zodiacList = [ {n:'é¼ ',i:'ğŸ­'}, {n:'ç‰›',i:'ğŸ®'}, {n:'è™',i:'ğŸ¯'}, {n:'å…”',i:'ğŸ°'}, {n:'é¾',i:'ğŸ²'}, {n:'è›‡',i:'ğŸ'}, {n:'é¦¬',i:'ğŸ´'}, {n:'ç¾Š',i:'ğŸ‘'}, {n:'çŒ´',i:'ğŸµ'}, {n:'é›',i:'ğŸ”'}, {n:'ç‹—',i:'ğŸ¶'}, {n:'è±¬',i:'ğŸ·'} ];

    const years = [], birthData = [], deathData = [], populationData = [], depTotalData = [], depYoungData = [], depOldData = [], rawTableData = [];

    for (let y = 1970; y <= 2025; y++) {
        years.push(y);
        let pop = interpolate(y, popBenchmarks).toFixed(1);
        populationData.push(pop);
        let depTotal = interpolate(y, exactDependencyData).toFixed(1);
        let depYoung = interpolate(y, exactYoungDepData).toFixed(1);
        let depOld = interpolate(y, exactOldDepData).toFixed(1);
        
        depTotalData.push(depTotal);
        depYoungData.push(depYoung);
        depOldData.push(depOld);

        let bVal = 0, dVal = 0;
        let vPrev = vitalStats[0], vNext = vitalStats[vitalStats.length-1];
        for(let v of vitalStats) {
            if (v.y <= y) vPrev = v;
            if (v.y > y) { vNext = v; break; }
        }
        if (vPrev.y === vNext.y) {
            bVal = vPrev.b; dVal = vPrev.d;
        } else {
            let r = (y - vPrev.y) / (vNext.y - vPrev.y);
            bVal = vPrev.b + r * (vNext.b - vPrev.b);
            dVal = vPrev.d + r * (vNext.d - vPrev.d);
        }
        birthData.push(Math.round(bVal * 10000));
        deathData.push(Math.round(dVal * 10000));

        const zIndex = (y - 1900) % 12;
        const zObj = zodiacList[zIndex];
        const supportRatio = (100 / depTotal).toFixed(1);

        rawTableData.unshift({
            year: y, zodiac: zObj.n, icon: zObj.i, birth: Math.round(bVal * 10000), death: Math.round(dVal * 10000),
            pop: pop, depT: depTotal, depY: depYoung, depO: depOld, support: supportRatio,
            diff: Math.round(bVal * 10000) - Math.round(dVal * 10000)
        });
    }

    const ctx = document.getElementById('mainChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: years,
            datasets: [
                { label: 'å‡ºç”Ÿäººæ•¸', data: birthData, borderColor: '#3498db', backgroundColor: 'rgba(52, 152, 219, 0.1)', yAxisID: 'y', tension: 0.4, pointRadius: 0, fill: false },
                { label: 'æ­»äº¡äººæ•¸', data: deathData, borderColor: '#e74c3c', backgroundColor: 'rgba(231, 76, 60, 0.1)', yAxisID: 'y', tension: 0.4, pointRadius: 0, fill: false },
                { label: 'ç¸½æ‰¶é¤Šæ¯”', data: depTotalData, borderColor: '#9b59b6', yAxisID: 'y1', borderDash: [5, 5], tension: 0.3, pointRadius: 0, fill: false },
                { label: 'æ‰¶å¹¼æ¯”', data: depYoungData, borderColor: '#2ecc71', yAxisID: 'y1', tension: 0.3, pointRadius: 0, fill: false },
                { label: 'æ‰¶è€æ¯”', data: depOldData, borderColor: '#d35400', yAxisID: 'y1', tension: 0.3, pointRadius: 0, fill: false },
                { label: 'ç¸½äººå£æ•¸ (è¬)', data: populationData, borderColor: '#f1c40f', backgroundColor: 'rgba(241, 196, 15, 0.1)', yAxisID: 'y2', tension: 0.4, borderWidth: 3, pointRadius: 0, fill: true }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            let val = context.parsed.y;
                            if (label === 'ç¸½æ‰¶é¤Šæ¯”') return `ğŸŸ£ å¹³å‡ ${ (100 / val).toFixed(1) }äºº é¤Š 1äºº`;
                            if (label === 'æ‰¶è€æ¯”') return `ğŸŸ¤ å¹³å‡ ${ (100 / val).toFixed(1) }äºº é¤Š 1è€äºº`;
                            if (label === 'æ‰¶å¹¼æ¯”') return `ğŸŸ¢ å¹³å‡ ${ (100 / val).toFixed(1) }äºº é¤Š 1å°å­©`;
                            if (label.includes('æ¯”')) return `${label}: ${val}%`;
                            if (label.includes('äººå£æ•¸')) return `${label}: ${val} è¬äºº`;
                            return `${label}: ${new Intl.NumberFormat('zh-TW').format(val)} äºº`;
                        }
                    }
                },
                annotation: {
                    annotations: {
                        milestone1993: {
                            type: 'line', xMin: 23, xMax: 23, borderColor: '#f1c40f', borderWidth: 2, borderDash: [4, 4],
                            label: { content: 'é«˜é½¡åŒ–(7%)', display: true, position: 'start', backgroundColor:'#f1c40f', color:'black', font:{size:fontBase}, yAdjust: 0 }
                        },
                        milestone2018: {
                            type: 'line', xMin: 48, xMax: 48, borderColor: '#d35400', borderWidth: 2, borderDash: [4, 4],
                            label: { content: 'é«˜é½¡(14%)', display: true, position: 'start', backgroundColor:'#d35400', font:{size:fontBase}, yAdjust: 60 } // æ‰‹æ©Ÿç‰ˆéŒ¯ä½
                        },
                        milestone2025: {
                            type: 'line', xMin: 55, xMax: 55, borderColor: '#c0392b', borderWidth: 2, borderDash: [4, 4],
                            label: { content: 'è¶…é«˜é½¡(20%)', display: true, position: 'start', backgroundColor:'#c0392b', font:{size:fontBase}, yAdjust: 0 }
                        },
                        line2015: {
                            type: 'line', xMin: 45, xMax: 45, borderColor: '#27ae60', borderWidth: 1, borderDash:[3,3],
                            label: { content: 'å‹å‹•åŠ›é«˜å³°', display: true, position: 'end', yAdjust: 20, backgroundColor:'#27ae60', font:{size:fontBase} }
                        },
                        line2017: { 
                            type: 'line', xMin: 47, xMax: 47, borderColor: '#7f8c8d', borderWidth: 1, borderDash: [2, 2],
                            label: { display: true, content: 'çµæ§‹äº¤å‰', position: 'end', backgroundColor: 'rgba(0,0,0,0.7)', font:{size:fontBase}, yAdjust: 30 }
                        },
                        line2020: {
                            type: 'line', xMin: 50, xMax: 50, borderColor: '#c0392b', borderWidth: 2,
                            label: { display: true, content: 'ğŸ’€ ç”Ÿæ­»äº¤å‰', position: 'center', backgroundColor: '#c0392b', color:'white', font:{size:fontBold}, yAdjust: -10 }
                        },
                        label1970Young: { type: 'label', xValue: 2, yValue: 68, content: ['1.4äºº','é¤Š1å°å­©'], color: '#27ae60', font: {size: fontBase, weight: 'bold'}, backgroundColor: 'rgba(255,255,255,0.7)' },
                        label2025Young: { type: 'label', xValue: 55, yValue: 16, content: ['6.1äºº','é¤Š1å°å­©'], color: '#27ae60', font: {size: fontBase, weight: 'bold'}, xAdjust: -30 },
                        label2025Old: { type: 'label', xValue: 55, yValue: 32, content: ['åƒ… 3.4äºº','é¤Š1è€äºº'], color: '#d35400', font: {size: fontBase, weight: 'bold'}, xAdjust: -35 }
                    }
                }
            },
            scales: {
                x: { ticks: { maxTicksLimit: isMobile ? 8 : 12, font: {size: fontBase} } },
                y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'äºº\næ•¸', color: '#555', font: {lineHeight: 1.4, size: fontBase} }, grid: { color: '#f0f0f0' }, ticks:{font:{size:fontBase}} },
                y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'æ¯”\nç‡', color: '#9b59b6', font: {lineHeight: 1.4, size: fontBase} }, grid: { drawOnChartArea: false }, min: 0, max: 80, ticks:{font:{size:fontBase}} },
                y2: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'ç¸½\näºº\nå£', color: '#f39c12', font: {lineHeight: 1.4, size: fontBase} }, grid: { drawOnChartArea: false }, min: 1400, max: 2500, ticks:{display: !isMobile} } // æ‰‹æ©Ÿç‰ˆéš±è—ç¬¬ä¸‰è»¸åˆ»åº¦ä»¥å…æ“æ“ 
            }
        }
    });

    const tableBody = document.querySelector('#dataTable tbody');
    rawTableData.forEach(d => {
        const tr = document.createElement('tr');
        if(d.zodiac==='é¾') tr.classList.add('dragon-row');
        let pressureClass = 'pressure-mid';
        const ratio = parseFloat(d.support);
        if (ratio >= 2.5) pressureClass = 'pressure-low'; if (ratio < 2.2) pressureClass = 'pressure-high';
        tr.innerHTML = `<td><span class="zodiac-icon">${d.icon}</span>${d.year} <small>${d.zodiac}</small></td><td>${new Intl.NumberFormat('zh-TW').format(d.birth)}</td><td>${new Intl.NumberFormat('zh-TW').format(d.death)}</td><td style="font-weight:bold; color:#f39c12">${d.pop}</td><td class="${d.diff<0?'negative-val':''}" style="color:${d.diff>0?'#27ae60':''}"> ${d.diff>0?'+':''}${new Intl.NumberFormat('zh-TW').format(d.diff)}</td><td style="color:#2ecc71">${d.depY}</td><td style="color:#d35400">${d.depO}</td><td style="font-weight:bold; color:#9b59b6">${d.depT}</td><td><span class="pressure-tag ${pressureClass}">${d.support}äºº é¤Š 1äºº</span></td>`;
        tableBody.appendChild(tr);
    });

    function toggleDataset(index, checkbox) {
        const isVisible = checkbox.checked;
        chart.setDatasetVisibility(index, isVisible);
        const btn = checkbox.parentElement;
        isVisible ? btn.classList.add('active') : btn.classList.remove('active');
        const ants = chart.options.plugins.annotation.annotations;
        if(index === 0 || index === 1) if(index === 1 && ants.line2020) ants.line2020.display = isVisible;
        if(index === 3) { if(ants.label1970Young) ants.label1970Young.display = isVisible; if(ants.label2025Young) ants.label2025Young.display = isVisible; }
        if(index === 4) { if(ants.label2025Old) ants.label2025Old.display = isVisible; if(ants.milestone1993) ants.milestone1993.display = isVisible; if(ants.milestone2018) ants.milestone2018.display = isVisible; if(ants.milestone2025) ants.milestone2025.display = isVisible; if(ants.line2017) ants.line2017.display = isVisible; }
        if(index === 5) if(ants.line2015) ants.line2015.display = isVisible;
        chart.update();
    }
</script>

</body>
</html>
