<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°ç£äººå£çµæ§‹æˆ°æƒ…å®¤</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <style>
        :root {
            --primary-blue: #2980b9;
            --primary-red: #c0392b;
            --primary-purple: #8e44ad;
            --primary-yellow: #f39c12;
            --primary-green: #27ae60;
            --primary-brown: #d35400;
            --bg-gray: #f4f6f8;
            --text-main: #2c3e50;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding: 10px;
            color: var(--text-main);
        }

        .container {
            width: 100%;
            max-width: 100%; 
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 15px 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
        }

        @media (min-width: 768px) {
            .container { max-width: 1200px; padding: 30px; }
        }

        header { text-align: center; margin-bottom: 20px; }
        h1 { margin: 0; font-size: 1.3rem; color: #333; }
        .subtitle { color: #666; font-size: 0.85rem; margin-top: 5px; }
        @media (min-width: 768px) { h1 { font-size: 1.8rem; } .subtitle { font-size: 1rem; } }

        /* --- å¡ç‰‡å€ --- */
        .cards-container { display: flex; gap: 10px; margin-bottom: 20px; }
        @media (max-width: 767px) {
            .cards-container { overflow-x: auto; padding-bottom: 5px; scroll-snap-type: x mandatory; }
            .cards-container::-webkit-scrollbar { display: none; }
            .stat-card { flex: 0 0 140px; scroll-snap-align: start; }
        }
        @media (min-width: 768px) {
            .cards-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); overflow-x: visible; }
            .stat-card { flex: auto; }
        }

        .stat-card {
            background: #fff; border: 1px solid #eee; border-left-width: 4px; border-radius: 8px;
            padding: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.03); display: flex; flex-direction: column; justify-content: center;
        }
        .stat-card h3 { margin: 0; font-size: 0.75rem; color: #777; }
        .stat-card .value { font-size: 1.2rem; font-weight: bold; margin: 4px 0; color: #333; }
        .stat-card .desc { font-size: 0.7rem; color: #999; }

        .c-green { border-left-color: var(--primary-green); }
        .c-brown { border-left-color: var(--primary-brown); }
        .c-red { border-left-color: var(--primary-red); }
        .c-dark { border-left-color: #34495e; }
        .c-blue { border-left-color: var(--primary-blue); }

        /* --- æŒ‰éˆ•å€ --- */
        .controls-panel { background: #fffbf5; border: 1px solid #ffe0b2; padding: 15px; border-radius: 10px; margin-bottom: 20px; }
        .control-header { text-align: center; font-size: 0.9rem; color: #d35400; font-weight: bold; margin-bottom: 10px; }
        .button-grid { display: grid; gap: 8px; }
        @media (max-width: 767px) { .button-grid { grid-template-columns: 1fr 1fr 1fr; } }
        @media (min-width: 768px) { .button-grid { display: flex; justify-content: center; gap: 15px; } .toggle-btn { padding: 8px 20px; font-size: 0.95rem; } }

        .toggle-btn {
            display: flex; align-items: center; justify-content: center; padding: 10px 4px;
            background: white; border: 1px solid #ddd; border-radius: 6px; font-size: 0.8rem;
            color: #666; cursor: pointer; transition: all 0.2s; user-select: none;
        }
        .toggle-btn:hover { background-color: #f0f0f0; transform: translateY(-2px); }
        .toggle-btn input { display: none; }
        .chip-dot { width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; background: #ccc; }
        
        .toggle-btn.active { border-color: transparent; color: white; font-weight: bold; box-shadow: 0 2px 6px rgba(0,0,0,0.15); }
        .toggle-btn.active.t-blue { background: var(--primary-blue); } .toggle-btn.active.t-blue .chip-dot { background: white; }
        .toggle-btn.active.t-red { background: var(--primary-red); } .toggle-btn.active.t-red .chip-dot { background: white; }
        .toggle-btn.active.t-purple { background: var(--primary-purple); } .toggle-btn.active.t-purple .chip-dot { background: white; }
        .toggle-btn.active.t-green { background: var(--primary-green); } .toggle-btn.active.t-green .chip-dot { background: white; }
        .toggle-btn.active.t-brown { background: var(--primary-brown); } .toggle-btn.active.t-brown .chip-dot { background: white; }
        .toggle-btn.active.t-yellow { background: #f39c12; } .toggle-btn.active.t-yellow .chip-dot { background: white; }

        /* --- åœ–è¡¨å€ --- */
        .chart-wrapper { position: relative; width: 100%; margin-bottom: 25px; }
        @media (max-width: 767px) { .chart-wrapper { height: 550px; min-height: 550px; } }
        @media (min-width: 768px) { .chart-wrapper { height: 600px; } }

        /* èªªæ˜èˆ‡è¡¨æ ¼ */
        .info-box { background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 0.9rem; color: #555; line-height: 1.6; border: 1px solid #eee; margin-bottom:20px; }
        .table-wrap { overflow-x: auto; border-top: 1px solid #eee; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; min-width: 800px; }
        th, td { padding: 12px 8px; text-align: center; border-bottom: 1px solid #f0f0f0; }
        th { background: #f1f1f1; position: sticky; top: 0; font-weight: bold; color: #444; }
        
        .support-val { font-weight: bold; padding: 3px 8px; border-radius: 12px; font-size:0.85rem;}
        .s-green { color: #27ae60; background: #eafaf1; }
        .s-brown { color: #d35400; background: #fdf2e9; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>å°ç£äººå£æˆ°æƒ…å®¤</h1>
        <div class="subtitle">1970-2025 ä¸–ä»£è² æ“”å¤§åè½‰</div>
    </header>

    <div class="cards-container">
        <div class="stat-card c-dark">
            <h3>ç”Ÿæ­»äº¤å‰ (æ­»>ç”Ÿ)</h3>
            <div class="value">2020å¹´</div>
            <div class="desc">è‡ªç„¶å¢åŠ ç‡è½‰è² </div>
        </div>
        <div class="stat-card c-green">
            <h3>2025 æ‰¶å¹¼è² æ“”</h3>
            <div class="value">6.1äºº</div>
            <div class="desc">é¤Š 1 å€‹å°å­©</div>
        </div>
        <div class="stat-card c-brown">
            <h3>2025 æ‰¶è€è² æ“”</h3>
            <div class="value">3.4äºº</div>
            <div class="desc">é¤Š 1 å€‹è€äºº</div>
        </div>
        <div class="stat-card c-red">
            <h3>çµæ§‹äº¤å‰ (2017)</h3>
            <div class="value">è€äºº>å°å­©</div>
            <div class="desc">é¤Šè€å£“åŠ›è¶…è¶Šé¤Šå¹¼</div>
        </div>
        <div class="stat-card c-blue">
            <h3>å‡ºç”Ÿæœ€é«˜å³°</h3>
            <div class="value">1976å¹´</div>
            <div class="desc">42.5è¬æ–°ç”Ÿå…’</div>
        </div>
    </div>

    <div class="controls-panel">
        <div class="control-header">â–¼ é»æ“Šåˆ‡æ›åœ–å±¤ â–¼</div>
        <div class="button-grid">
            <label class="toggle-btn t-blue active">
                <input type="checkbox" checked onchange="toggleDataset(0, this)">
                <span class="chip-dot"></span>å‡ºç”Ÿ
            </label>
            <label class="toggle-btn t-red active">
                <input type="checkbox" checked onchange="toggleDataset(1, this)">
                <span class="chip-dot"></span>æ­»äº¡
            </label>
            <label class="toggle-btn t-brown">
                <input type="checkbox" onchange="toggleDataset(4, this)">
                <span class="chip-dot"></span>æ‰¶è€æ¯”
            </label>
            <label class="toggle-btn t-green">
                <input type="checkbox" onchange="toggleDataset(3, this)">
                <span class="chip-dot"></span>æ‰¶å¹¼æ¯”
            </label>
            <label class="toggle-btn t-purple">
                <input type="checkbox" onchange="toggleDataset(2, this)">
                <span class="chip-dot"></span>ç¸½æ‰¶é¤Šæ¯”
            </label>
            <label class="toggle-btn t-yellow">
                <input type="checkbox" onchange="toggleDataset(5, this)">
                <span class="chip-dot"></span>ç¸½äººå£
            </label>
        </div>
    </div>

    <div class="chart-wrapper">
        <canvas id="mainChart"></canvas>
    </div>

    <div class="info-box">
        ğŸ’¡ <strong>æ“ä½œæç¤ºï¼š</strong>
        <ul>
            <li>é è¨­é¡¯ç¤º ğŸ”µ <strong>å‡ºç”Ÿ</strong> èˆ‡ ğŸ”´ <strong>æ­»äº¡</strong> æ›²ç·šï¼Œç›´è§€å‘ˆç¾äººå£è‡ªç„¶æ¶ˆé•·ã€‚</li>
            <li>é»æ“Šä¸Šæ–¹æŒ‰éˆ•å¯ç–ŠåŠ é¡¯ç¤ºã€Œæ‰¶é¤Šå£“åŠ›ã€æˆ–ã€Œç¸½äººå£ã€è¶¨å‹¢ã€‚</li>
            <li><strong>ç”Ÿæ­»äº¤å‰ï¼š</strong>2020å¹´èµ·æ­»äº¡äººæ•¸è¶…è¶Šå‡ºç”Ÿäººæ•¸ï¼ˆç´…ç·šé«˜æ–¼è—ç·šï¼‰ï¼Œé€²å…¥è² æˆé•·æ™‚ä»£ã€‚</li>
        </ul>
    </div>

    <div class="table-wrap">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>å¹´åº¦</th>
                    <th>å‡ºç”Ÿæ•¸</th>
                    <th>æ­»äº¡æ•¸</th>
                    <th>é¤Šå¹¼è² æ“”</th>
                    <th>é¤Šè€è² æ“”</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const isMobile = window.innerWidth < 768;
        Chart.defaults.font.size = isMobile ? 11 : 13;
        Chart.defaults.font.family = '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial';

        // --- æ•¸æ“šåº« ---
        const popBenchmarks = { 1970:1467, 1975:1615, 1980:1780, 1985:1925, 1990:2035, 1995:2130, 2000:2218, 2005:2270, 2010:2316, 2015:2349, 2019:2360, 2020:2356, 2021:2337, 2022:2326, 2023:2342, 2024:2340, 2025:2310 };
        const exactDependencyData = { 1970:74.0, 1975:66.0, 1980:58.7, 1985:51.5, 1990:47.9, 1995:45.6, 2000:42.1, 2005:39.0, 2010:35.9, 2012:34.7, 2015:35.3, 2016:36.2, 2017:37.0, 2018:37.9, 2019:38.9, 2020:40.2, 2021:41.3, 2022:42.2, 2023:43.1, 2024:44.3, 2025:45.8 };
        const exactYoungDepData = { 1970:69.6, 1975:60.5, 1980:52.0, 1985:43.4, 1990:38.8, 1995:35.0, 2000:30.2, 2005:25.4, 2010:20.7, 2012:19.8, 2015:19.3, 2016:18.8, 2017:18.2, 2018:17.7, 2019:17.5, 2020:17.6, 2021:17.5, 2022:17.2, 2023:17.0, 2024:16.7, 2025:16.5 };
        const exactOldDepData = { 1970:4.4, 1975:5.5, 1980:6.7, 1985:8.1, 1990:9.1, 1995:10.6, 2000:11.9, 2005:13.6, 2010:15.2, 2012:14.9, 2015:16.0, 2016:17.4, 2017:18.8, 2018:20.2, 2019:21.4, 2020:22.6, 2021:23.8, 2022:25.0, 2023:26.1, 2024:27.6, 2025:29.3 };
        const vitalStats = [ {y:1970,b:39.4,d:10.4},{y:1975,b:36.9,d:10.4},{y:1976,b:42.5,d:10.6},{y:1980,b:41.3,d:10.9},{y:1985,b:34.6,d:11.2},{y:1990,b:33.5,d:11.9},{y:1995,b:32.9,d:12.6},{y:2000,b:30.5,d:13.1},{y:2005,b:20.5,d:13.9},{y:2010,b:16.6,d:14.5},{y:2012,b:22.9,d:15.4},{y:2015,b:21.3,d:16.3},{y:2016,b:20.8,d:17.2},{y:2017,b:19.3,d:17.1},{y:2018,b:18.1,d:17.2},{y:2019,b:17.7,d:17.6},{y:2020,b:16.5,d:17.3},{y:2021,b:15.3,d:18.3},{y:2022,b:13.8,d:20.7},{y:2023,b:13.5,d:20.5},{y:2024,b:13.4,d:20.2},{y:2025,b:10.7,d:18.2} ];

        function interpolate(year, benchmarks) {
            if (benchmarks[year] !== undefined) return benchmarks[year];
            const keys = Object.keys(benchmarks).map(Number).sort((a,b)=>a-b);
            let prev = keys[0], next = keys[keys.length-1];
            for(let k of keys) { if (k <= year) prev = k; if (k > year) { next = k; break; } }
            if (prev === next) return benchmarks[prev];
            const ratio = (year - prev) / (next - prev);
            return benchmarks[prev] + ratio * (benchmarks[next] - benchmarks[prev]);
        }

        const years=[], birthData=[], deathData=[], populationData=[], depTotalData=[], depYoungData=[], depOldData=[], rawTableData=[];

        for (let y = 1970; y <= 2025; y++) {
            years.push(y);
            let pop = interpolate(y, popBenchmarks).toFixed(1); populationData.push(pop);
            let depTotal = interpolate(y, exactDependencyData).toFixed(1); depTotalData.push(depTotal);
            let depYoung = interpolate(y, exactYoungDepData).toFixed(1); depYoungData.push(depYoung);
            let depOld = interpolate(y, exactOldDepData).toFixed(1); depOldData.push(depOld);

            let bVal=0, dVal=0;
            let vPrev=vitalStats[0], vNext=vitalStats[vitalStats.length-1];
            for(let v of vitalStats) { if(v.y<=y) vPrev=v; if(v.y>y){ vNext=v; break; } }
            if(vPrev.y===vNext.y) { bVal=vPrev.b; dVal=vPrev.d; }
            else { let r=(y-vPrev.y)/(vNext.y-vPrev.y); bVal=vPrev.b+r*(vNext.b-vPrev.b); dVal=vPrev.d+r*(vNext.d-vPrev.d); }
            
            birthData.push(Math.round(bVal*10000)); deathData.push(Math.round(dVal*10000));
            const supportYoung = (100 / depYoung).toFixed(1);
            const supportOld = (100 / depOld).toFixed(1);

            rawTableData.unshift({ 
                year:y, birth:Math.round(bVal*10000), death:Math.round(dVal*10000), 
                pop:pop, depY:depYoung, depO:depOld, 
                sYoung: supportYoung, sOld: supportOld 
            });
        }

        const ctx = document.getElementById('mainChart').getContext('2d');
        window.myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: years,
                datasets: [
                    { label: 'å‡ºç”Ÿ', data: birthData, borderColor: '#2980b9', borderWidth: 2, pointRadius: 0, tension: 0.4, yAxisID: 'y', hidden: false }, // é è¨­é–‹å•Ÿ
                    { label: 'æ­»äº¡', data: deathData, borderColor: '#c0392b', borderWidth: 2, pointRadius: 0, tension: 0.4, yAxisID: 'y', hidden: false }, // é è¨­é–‹å•Ÿ
                    { label: 'ç¸½æ‰¶é¤Šæ¯”', data: depTotalData, borderColor: '#8e44ad', borderWidth: 2, pointRadius: 0, tension: 0.3, yAxisID: 'y1', hidden: true },
                    { label: 'æ‰¶å¹¼æ¯”', data: depYoungData, borderColor: '#27ae60', borderWidth: 3, pointRadius: 0, tension: 0.3, yAxisID: 'y1', hidden: true },
                    { label: 'æ‰¶è€æ¯”', data: depOldData, borderColor: '#d35400', borderWidth: 3, pointRadius: 0, tension: 0.3, yAxisID: 'y1', hidden: true },
                    { label: 'ç¸½äººå£', data: populationData, borderColor: '#f39c12', borderWidth: 2, pointRadius: 0, tension: 0.4, yAxisID: 'y2', hidden: true }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        padding: 8, backgroundColor: 'rgba(255,255,255,0.95)', titleColor:'#333', bodyColor:'#333', borderColor:'#ccc', borderWidth:1,
                        callbacks: {
                            label: (ctx) => {
                                const v = ctx.parsed.y;
                                if (ctx.dataset.label === 'æ‰¶å¹¼æ¯”') return `ğŸŸ¢ å¹³å‡ ${ (100/v).toFixed(1) }äºº é¤Š 1å°å­©`;
                                if (ctx.dataset.label === 'æ‰¶è€æ¯”') return `ğŸŸ¤ å¹³å‡ ${ (100/v).toFixed(1) }äºº é¤Š 1è€äºº`;
                                if (ctx.dataset.label === 'ç¸½æ‰¶é¤Šæ¯”') return `ğŸŸ£ å¹³å‡ ${ (100/v).toFixed(1) }äºº é¤Š 1äºº`;
                                if (ctx.dataset.label.includes('å‡ºç”Ÿ') || ctx.dataset.label.includes('æ­»äº¡')) return `${ctx.dataset.label}: ${Math.round(v/10000)}è¬`;
                                if (ctx.dataset.label.includes('äººå£')) return `${ctx.dataset.label}: ${v}è¬`;
                                return `${ctx.dataset.label}: ${v}`;
                            }
                        }
                    },
                    annotation: {
                        annotations: {
                            // é è¨­é—œé–‰çš„è¨»è¨˜
                            label1970Y: { type: 'label', xValue: 2, yValue: 68, content: ['1.4äºº','é¤Š1å¹¼'], color: '#27ae60', font: {size: 11, weight: 'bold'}, backgroundColor: 'rgba(255,255,255,0.8)', display:false },
                            label2025Y: { type: 'label', xValue: 55, yValue: 16, content: ['6.1äºº','é¤Š1å¹¼'], color: '#27ae60', font: {size: 11, weight: 'bold'}, xAdjust: -30, display:false },
                            label2025O: { type: 'label', xValue: 55, yValue: 32, content: ['3.4äºº','é¤Š1è€'], color: '#d35400', font: {size: 11, weight: 'bold'}, xAdjust: -30, display:false },
                            line2017: { type: 'line', xMin: 47, xMax: 47, borderColor: '#7f8c8d', borderWidth: 1, borderDash: [2, 2], label: { display: true, content: 'çµæ§‹äº¤å‰', position: 'end', backgroundColor: 'rgba(0,0,0,0.6)', font:{size:10}, yAdjust: 30 }, display:false },
                            
                            // é è¨­é–‹å•Ÿçš„è¨»è¨˜ (ç”Ÿæ­»äº¤å‰)
                            line2020: { type: 'line', xMin: 50, xMax: 50, borderColor: '#c0392b', borderWidth: 1, label: { display: true, content: 'ç”Ÿæ­»äº¤å‰', position: 'center', backgroundColor: '#c0392b', color:'white', font:{size:10}, yAdjust: -10 }, display:true }
                        }
                    }
                },
                scales: {
                    x: { ticks: { maxTicksLimit: 8, font: {size:10} }, grid: {display:false} },
                    y: { type: 'linear', position: 'left', title: {display:true, text:'äºº (è¬)'}, ticks: { font:{size:10}, callback: v => v/10000 } },
                    y1: { type: 'linear', position: 'right', title: {display:true, text:'æ¯”ç‡ (%)'}, grid:{display:false}, min:0, max:80 },
                    y2: { type: 'linear', position: 'right', display: false, min:1400, max:2500 }
                }
            }
        });

        // è¡¨æ ¼å¡«å……
        const tbody = document.querySelector('#dataTable tbody');
        rawTableData.forEach(d => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${d.year}</td><td>${Math.round(d.birth/10000)}è¬</td><td>${Math.round(d.death/10000)}è¬</td><td class="support-val s-green">${d.sYoung}äºº</td><td class="support-val s-brown">${d.sOld}äºº</td>`;
            tbody.appendChild(tr);
        });
    });

    // åˆ‡æ›åŠŸèƒ½
    window.toggleDataset = function(index, chip) {
        const isVisible = chip.checked;
        window.myChart.setDatasetVisibility(index, isVisible);
        const label = chip.parentElement;
        isVisible ? label.classList.add('active') : label.classList.remove('active');

        const ants = window.myChart.options.plugins.annotation.annotations;
        if (index === 3) { ants.label1970Y.display = isVisible; ants.label2025Y.display = isVisible; }
        if (index === 4) { ants.label2025O.display = isVisible; ants.line2017.display = isVisible; }
        if (index === 1) { ants.line2020.display = isVisible; }
        window.myChart.update();
    }
</script>

</body>
</html>
