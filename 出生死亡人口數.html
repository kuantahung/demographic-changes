<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£äººå£çµæ§‹æˆ°æƒ…å®¤ï¼šé›™äº¤å‰é»ä¿®æ­£ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@2.1.0/dist/chartjs-plugin-annotation.min.js"></script>
    <style>
        :root {
            --primary-blue: #3498db;
            --primary-red: #e74c3c;
            --primary-purple: #9b59b6;
            --primary-yellow: #f1c40f;
            --primary-green: #2ecc71;
            --primary-brown: #d35400;
            --dark-bg: #2c3e50;
            --light-bg: #f4f6f9;
        }

        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", Roboto, Arial, sans-serif;
            background-color: var(--light-bg);
            margin: 0;
            padding: 10px;
            color: #333;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--dark-bg);
            margin: 0;
            font-size: clamp(1.4rem, 4vw, 2.2rem);
            line-height: 1.4;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            margin-top: 8px;
        }

        /* æ§åˆ¶å° */
        .controls-panel {
            background: #fff8f0;
            border: 1px solid #ffe0b2;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .control-title {
            font-weight: bold;
            color: var(--primary-brown);
            margin-right: 5px;
            font-size: 0.9rem;
        }

        .toggle-btn {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 6px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 30px;
            transition: all 0.2s;
            user-select: none;
            font-size: 0.85rem;
            color: #666;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .toggle-btn:hover { background: #f1f1f1; transform: translateY(-1px); }
        .toggle-btn input { display: none; }
        .toggle-btn.active { border-color: transparent; color: white; box-shadow: 0 3px 6px rgba(0,0,0,0.15); }

        .btn-blue.active { background-color: var(--primary-blue); }
        .btn-red.active { background-color: var(--primary-red); }
        .btn-purple.active { background-color: var(--primary-purple); }
        .btn-yellow.active { background-color: #f39c12; }
        .btn-green.active { background-color: var(--primary-green); }
        .btn-brown.active { background-color: var(--primary-brown); }
        
        .indicator-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
            background: #ccc;
            border: 1px solid white;
        }
        .toggle-btn.active .indicator-dot { background: white; }

        /* æ•¸æ“šå¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 15px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
            min-height: 100px;
        }

        .stat-card::after {
            content: "";
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(255,255,255,0.1), rgba(255,255,255,0));
            pointer-events: none;
        }

        .stat-card h3 { margin: 0; font-size: 0.85rem; opacity: 0.95; }
        .stat-card .value { font-size: 1.4rem; font-weight: bold; margin: 5px 0; }
        .stat-card .desc { font-size: 0.75rem; opacity: 0.9; }

        .bg-blue { background: linear-gradient(135deg, #3498db, #2980b9); }
        .bg-red { background: linear-gradient(135deg, #e74c3c, #c0392b); }
        .bg-green { background: linear-gradient(135deg, #27ae60, #2ecc71); }
        .bg-brown { background: linear-gradient(135deg, #d35400, #a04000); }
        .bg-dark { background: linear-gradient(135deg, #34495e, #2c3e50); }
        .bg-red-alert { background: linear-gradient(135deg, #c0392b, #922b21); }

        .chart-wrapper {
            position: relative;
            height: 600px;
            width: 100%;
            margin-bottom: 40px;
        }

        .table-container {
            width: 100%;
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #eee;
            margin-bottom: 30px;
            max-height: 600px;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
            min-width: 1100px; 
        }

        th {
            background-color: var(--dark-bg);
            color: white;
            padding: 10px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 8px 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .zodiac-icon { margin-right: 5px; }
        .negative-val { color: #c0392b; font-weight: bold; }
        .dragon-row { background-color: #fffde7; }
        
        .pressure-tag {
            display: inline-block; padding: 4px 10px; border-radius: 15px; font-size: 0.85rem; font-weight: bold;
        }
        .pressure-low { background-color: #d5f5e3; color: #1e8449; }
        .pressure-mid { background-color: #fcf3cf; color: #b7950b; }
        .pressure-high { background-color: #fadbd8; color: #922b21; }

        .footer-note {
            background-color: #fffaf0;
            border-left: 5px solid var(--primary-brown);
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        .footer-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--dark-bg);
        }
        
        .definition-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }

        .def-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ccc;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .def-card h5 { margin: 0 0 5px 0; font-size: 1rem; }
        .def-card p { margin: 5px 0 0 0; font-size: 0.85rem; color: #666; line-height: 1.5; }
        
        .def-card.young { border-left-color: var(--primary-green); }
        .def-card.old { border-left-color: var(--primary-brown); }
        .def-card.total { border-left-color: var(--primary-purple); }

        .trend-note {
            margin-top: 15px;
            font-size: 0.9rem;
            color: #555;
            padding-top: 10px;
            border-top: 1px solid #e9ecef;
        }

        @media (max-width: 600px) {
            .controls-panel { gap: 6px; }
            .toggle-btn { font-size: 0.75rem; padding: 5px 8px; }
            .chart-wrapper { height: 450px; }
            .definition-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>å°ç£äººå£çµæ§‹æˆ°æƒ…å®¤ (1970-2025)</h1>
        <div class="subtitle">å¾ã€Œé«˜é½¡åŒ–ã€åˆ°ã€Œè¶…é«˜é½¡ã€ï¼šé›™äº¤å‰é»åœ–è§£</div>
    </header>

    <div class="controls-panel">
        <span class="control-title">åœ–å±¤é–‹é—œï¼š</span>
        <label class="toggle-btn btn-blue active">
            <input type="checkbox" checked onchange="toggleDataset(0, this)"> <span class="indicator-dot"></span> å‡ºç”Ÿ
        </label>
        <label class="toggle-btn btn-red active">
            <input type="checkbox" checked onchange="toggleDataset(1, this)"> <span class="indicator-dot"></span> æ­»äº¡
        </label>
        <label class="toggle-btn btn-purple active">
            <input type="checkbox" checked onchange="toggleDataset(2, this)"> <span class="indicator-dot"></span> ç¸½æ‰¶é¤Šæ¯”
        </label>
        <label class="toggle-btn btn-green active">
            <input type="checkbox" checked onchange="toggleDataset(3, this)"> <span class="indicator-dot"></span> æ‰¶å¹¼æ¯”
        </label>
        <label class="toggle-btn btn-brown active">
            <input type="checkbox" checked onchange="toggleDataset(4, this)"> <span class="indicator-dot"></span> æ‰¶è€æ¯”
        </label>
        <label class="toggle-btn btn-yellow active">
            <input type="checkbox" checked onchange="toggleDataset(5, this)"> <span class="indicator-dot"></span> ç¸½äººå£
        </label>
    </div>

    <div class="stats-grid">
        <div class="stat-card bg-green">
            <h3>å‹å‹•åŠ›é«˜å³° (2015)</h3>
            <div class="value">1,737 è¬</div>
            <div class="desc">å·¥ä½œäººå£æ­·å²é ‚é»</div>
        </div>
        <div class="stat-card bg-brown">
            <h3>çµæ§‹äº¤å‰ (2017)</h3>
            <div class="value">è€äºº > å°å­©</div>
            <div class="desc">è€åŒ–æŒ‡æ•¸ç ´ 100%</div>
        </div>
        <div class="stat-card bg-dark">
            <h3>ç”Ÿæ­»äº¤å‰ (2020)</h3>
            <div class="value">ç”Ÿä¸å¦‚æ­»</div>
            <div class="desc">æ­»äº¡æ•¸ > å‡ºç”Ÿæ•¸</div>
        </div>
        <div class="stat-card bg-red-alert">
            <h3>è¶…é«˜é½¡ç¤¾æœƒ (2025)</h3>
            <div class="value">20% è€äºº</div>
            <div class="desc">æ¯ 5 äººå°±æœ‰ 1 ä½è€äºº</div>
        </div>
    </div>

    <div class="chart-wrapper">
        <canvas id="mainChart"></canvas>
    </div>

    <div class="table-container">
        <table id="dataTable">
            <thead>
                <tr>
                    <th>å¹´åº¦</th>
                    <th>å‡ºç”Ÿäººæ•¸</th>
                    <th>æ­»äº¡äººæ•¸</th>
                    <th>ç¸½äººå£(è¬)</th>
                    <th>è‡ªç„¶å¢åŠ </th>
                    <th>æ‰¶å¹¼æ¯”</th>
                    <th>æ‰¶è€æ¯”</th>
                    <th>ç¸½æ‰¶é¤Šæ¯”</th>
                    <th>ç¸½æ’«é¤Šå£“åŠ› (å¹¾ä½é’å£¯å¹´é¤Š1ä½è€å¹¼)</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="footer-note">
        <div class="footer-title">ğŸ’¡ é—œéµåè©è§£è®€</div>
        <div class="definition-grid">
            <div class="def-card young">
                <h5>ğŸ‘¶ äººå£ç´…åˆ© (Demographic Dividend)</h5>
                <p>æŒ‡ã€Œç¸½æ‰¶é¤Šæ¯”ã€ä½æ–¼ 50% çš„æ™‚æœŸï¼ˆåœ–è¡¨ä¸­ç´„ 1990-2025ï¼‰ã€‚æ­¤æ™‚å‹å‹•åŠ›å……è¶³ã€è² æ“”è¼•ï¼Œæœ‰åˆ©ç¶“æ¿Ÿç™¼å±•ã€‚ä½† 2025 å¾Œå°‡é€æ¼¸æ¶ˆå¤±ã€‚</p>
            </div>
            <div class="def-card old">
                <h5>ğŸ‘µ å°ç£è€åŒ–çš„ä¸‰å€‹éšæ®µ</h5>
                <p>
                    1. <strong>é«˜é½¡åŒ–ç¤¾æœƒ (7%)</strong>ï¼š1993å¹´<br>
                    2. <strong>é«˜é½¡ç¤¾æœƒ (14%)</strong>ï¼š2018å¹´<br>
                    3. <strong>è¶…é«˜é½¡ç¤¾æœƒ (20%)</strong>ï¼š2025å¹´ (æˆ‘å€‘åœ¨é€™è£¡)<br>
                    <span style="color:#d35400; font-size:0.8rem;">* å¾é«˜é½¡åˆ°è¶…é«˜é½¡åªèŠ±äº†7å¹´ï¼Œé€Ÿåº¦ä¸–ç•Œç½•è¦‹ã€‚</span>
                </p>
            </div>
            <div class="def-card total">
                <h5>ğŸ“‰ å‹å‹•åŠ›æ‹é» (Labor Force Peak)</h5>
                <p>2015 å¹´å°ç£ 15-64 æ­²å·¥ä½œå¹´é½¡äººå£é”åˆ°æœ€é«˜å³°ï¼Œä¹‹å¾Œé–‹å§‹é€å¹´æ¸›å°‘ï¼Œé€™æ„å‘³è‘—å‹å‹•åŠ›çŸ­ç¼ºå°‡æˆç‚ºå¸¸æ…‹ã€‚</p>
            </div>
        </div>
    </div>
</div>

<script>
    Chart.register(window['chartjs-plugin-annotation']);

    // --- æ•¸æ“šåº« ---
    const popBenchmarks = {
        1970: 1467, 1975: 1615, 1980: 1780, 1985: 1925, 1990: 2035,
        1995: 2130, 2000: 2218, 2005: 2270, 2010: 2316, 2015: 2349,
        2019: 2360, 2020: 2356, 2021: 2337, 2022: 2326, 2023: 2342, 2024: 2340, 2025: 2310
    };

    const exactDependencyData = {
        1970: 74.0, 1975: 66.0, 1980: 58.7, 1985: 51.5, 1990: 47.9,
        1995: 45.6, 2000: 42.1, 2005: 39.0, 2010: 35.9, 2012: 34.7,
        2015: 35.3, 2016: 36.2, 2017: 37.0, 2018: 37.9, 2019: 38.9, 
        2020: 40.2, 2021: 41.3, 2022: 42.2, 2023: 43.1, 2024: 44.3, 2025: 45.8
    };

    const exactYoungDepData = {
        1970: 69.6, 1975: 60.5, 1980: 52.0, 1985: 43.4, 1990: 38.8,
        1995: 35.0, 2000: 30.2, 2005: 25.4, 2010: 20.7, 2012: 19.8,
        2015: 19.3, 2016: 18.8, 2017: 18.2, 2018: 17.7, 2019: 17.5,
        2020: 17.6, 2021: 17.5, 2022: 17.2, 2023: 17.0, 2024: 16.7, 2025: 16.5
    };

    const exactOldDepData = {
        1970: 4.4, 1975: 5.5, 1980: 6.7, 1985: 8.1, 1990: 9.1,
        1995: 10.6, 2000: 11.9, 2005: 13.6, 2010: 15.2, 2012: 14.9,
        2015: 16.0, 2016: 17.4, 2017: 18.8, 2018: 20.2, 2019: 21.4,
        2020: 22.6, 2021: 23.8, 2022: 25.0, 2023: 26.1, 2024: 27.6, 2025: 29.3
    };

    const vitalStats = [
        {y:1970, b:39.4, d:10.4}, {y:1975, b:36.9, d:10.4}, {y:1976, b:42.5, d:10.6},
        {y:1980, b:41.3, d:10.9}, {y:1985, b:34.6, d:11.2}, {y:1990, b:33.5, d:11.9},
        {y:1995, b:32.9, d:12.6}, {y:2000, b:30.5, d:13.1}, {y:2005, b:20.5, d:13.9},
        {y:2010, b:16.6, d:14.5}, {y:2012, b:22.9, d:15.4}, {y:2015, b:21.3, d:16.3},
        {y:2016, b:20.8, d:17.2}, {y:2017, b:19.3, d:17.1}, {y:2018, b:18.1, d:17.2},
        {y:2019, b:17.7, d:17.6}, {y:2020, b:16.5, d:17.3}, {y:2021, b:15.3, d:18.3},
        {y:2022, b:13.8, d:20.7}, {y:2023, b:13.5, d:20.5}, {y:2024, b:13.4, d:20.2},
        {y:2025, b:10.7, d:18.2} 
    ];

    function interpolate(year, benchmarks) {
        if (benchmarks[year] !== undefined) return benchmarks[year];
        const keys = Object.keys(benchmarks).map(Number).sort((a,b)=>a-b);
        let prev = keys[0], next = keys[keys.length-1];
        for(let k of keys) {
            if (k <= year) prev = k;
            if (k > year) { next = k; break; }
        }
        if (prev === next) return benchmarks[prev];
        const ratio = (year - prev) / (next - prev);
        return benchmarks[prev] + ratio * (benchmarks[next] - benchmarks[prev]);
    }

    const zodiacList = [
        {n:'é¼ ', i:'ğŸ­'}, {n:'ç‰›', i:'ğŸ®'}, {n:'è™', i:'ğŸ¯'}, {n:'å…”', i:'ğŸ°'},
        {n:'é¾', i:'ğŸ²'}, {n:'è›‡', i:'ğŸ'}, {n:'é¦¬', i:'ğŸ´'}, {n:'ç¾Š', i:'ğŸ‘'},
        {n:'çŒ´', i:'ğŸµ'}, {n:'é›', i:'ğŸ”'}, {n:'ç‹—', i:'ğŸ¶'}, {n:'è±¬', i:'ğŸ·'}
    ];

    const years = [], birthData = [], deathData = [], populationData = [];
    const depTotalData = [], depYoungData = [], depOldData = [];
    const rawTableData = [];

    for (let y = 1970; y <= 2025; y++) {
        years.push(y);
        let pop = interpolate(y, popBenchmarks).toFixed(1);
        populationData.push(pop);
        
        let depTotal = interpolate(y, exactDependencyData).toFixed(1);
        let depYoung = interpolate(y, exactYoungDepData).toFixed(1);
        let depOld = interpolate(y, exactOldDepData).toFixed(1);
        
        depTotalData.push(depTotal);
        depYoungData.push(depYoung);
        depOldData.push(depOld);

        let bVal = 0, dVal = 0;
        let vPrev = vitalStats[0], vNext = vitalStats[vitalStats.length-1];
        for(let v of vitalStats) {
            if (v.y <= y) vPrev = v;
            if (v.y > y) { vNext = v; break; }
        }
        if (vPrev.y === vNext.y) {
            bVal = vPrev.b; dVal = vPrev.d;
        } else {
            let r = (y - vPrev.y) / (vNext.y - vPrev.y);
            bVal = vPrev.b + r * (vNext.b - vPrev.b);
            dVal = vPrev.d + r * (vNext.d - vPrev.d);
        }
        
        birthData.push(Math.round(bVal * 10000));
        deathData.push(Math.round(dVal * 10000));

        const zIndex = (y - 1900) % 12;
        const zObj = zodiacList[zIndex];
        const supportRatio = (100 / depTotal).toFixed(1);

        rawTableData.unshift({
            year: y,
            zodiac: zObj.n,
            icon: zObj.i,
            birth: Math.round(bVal * 10000),
            death: Math.round(dVal * 10000),
            pop: pop,
            depT: depTotal,
            depY: depYoung,
            depO: depOld,
            support: supportRatio,
            diff: Math.round(bVal * 10000) - Math.round(dVal * 10000)
        });
    }

    const ctx = document.getElementById('mainChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: years,
            datasets: [
                {
                    label: 'å‡ºç”Ÿäººæ•¸',
                    data: birthData,
                    borderColor: '#3498db',
                    backgroundColor: 'rgba(52, 152, 219, 0.1)',
                    yAxisID: 'y',
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    fill: false 
                },
                {
                    label: 'æ­»äº¡äººæ•¸',
                    data: deathData,
                    borderColor: '#e74c3c',
                    backgroundColor: 'rgba(231, 76, 60, 0.1)',
                    yAxisID: 'y',
                    tension: 0.4,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    fill: false
                },
                {
                    label: 'ç¸½æ‰¶é¤Šæ¯”',
                    data: depTotalData,
                    borderColor: '#9b59b6',
                    yAxisID: 'y1',
                    borderDash: [5, 5],
                    tension: 0.3,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    fill: false
                },
                {
                    label: 'æ‰¶å¹¼æ¯”', 
                    data: depYoungData,
                    borderColor: '#2ecc71',
                    yAxisID: 'y1',
                    tension: 0.3,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    fill: false
                },
                {
                    label: 'æ‰¶è€æ¯”', 
                    data: depOldData,
                    borderColor: '#d35400',
                    yAxisID: 'y1',
                    tension: 0.3,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    fill: false
                },
                {
                    label: 'ç¸½äººå£æ•¸ (è¬)',
                    data: populationData,
                    borderColor: '#f1c40f',
                    backgroundColor: 'rgba(241, 196, 15, 0.1)',
                    yAxisID: 'y2',
                    tension: 0.4,
                    borderWidth: 3,
                    pointRadius: 0,
                    pointHoverRadius: 6,
                    fill: true 
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            let val = context.parsed.y;
                            if (label === 'ç¸½æ‰¶é¤Šæ¯”') return `ğŸŸ£ å¹³å‡ ${ (100 / val).toFixed(1) }äºº é¤Š 1äºº`;
                            if (label === 'æ‰¶è€æ¯”') return `ğŸŸ¤ å¹³å‡ ${ (100 / val).toFixed(1) }äºº é¤Š 1è€äºº`;
                            if (label === 'æ‰¶å¹¼æ¯”') return `ğŸŸ¢ å¹³å‡ ${ (100 / val).toFixed(1) }äºº é¤Š 1å°å­©`;
                            if (label.includes('æ¯”')) return `${label}: ${val}%`;
                            if (label.includes('äººå£æ•¸')) return `${label}: ${val} è¬äºº`;
                            return `${label}: ${new Intl.NumberFormat('zh-TW').format(val)} äºº`;
                        }
                    }
                },
                annotation: {
                    annotations: {
                        // 1. é«˜é½¡åŒ–ç¤¾æœƒ (7%) - 1993
                        milestone1993: {
                            type: 'line', xMin: 23, xMax: 23, borderColor: '#f1c40f', borderWidth: 2, borderDash: [4, 4],
                            label: { content: '1993 é«˜é½¡åŒ–(7%)', display: true, position: 'start', backgroundColor:'#f1c40f', color:'black', font:{size:11}, yAdjust: 0 }
                        },
                        // 2. é«˜é½¡ç¤¾æœƒ (14%) - 2018 (é—œéµä¿®æ­£ï¼šå¤§å¹…ä¸‹ç§» yAdjust ä»¥éŒ¯ä½)
                        milestone2018: {
                            type: 'line', xMin: 48, xMax: 48, borderColor: '#d35400', borderWidth: 2, borderDash: [4, 4],
                            label: { content: '2018 é«˜é½¡(14%)', display: true, position: 'start', backgroundColor:'#d35400', font:{size:11}, yAdjust: 60 } 
                        },
                        // 3. è¶…é«˜é½¡ç¤¾æœƒ (20%) - 2025 (ç¶­æŒæœ€ä¸Šæ–¹)
                        milestone2025: {
                            type: 'line', xMin: 55, xMax: 55, borderColor: '#c0392b', borderWidth: 2, borderDash: [4, 4],
                            label: { content: '2025 è¶…é«˜é½¡(20%)', display: true, position: 'start', backgroundColor:'#c0392b', font:{size:11}, yAdjust: 0 }
                        },
                        // 4. å‹å‹•åŠ›é«˜å³° - 2015
                        line2015: {
                            type: 'line', xMin: 45, xMax: 45, borderColor: '#27ae60', borderWidth: 1, borderDash:[3,3],
                            label: { content: 'å‹å‹•åŠ›é«˜å³°', display: true, position: 'end', yAdjust: 20, backgroundColor:'#27ae60' }
                        },
                        
                        // 5. çµæ§‹äº¤å‰é» (è€>å¹¼)
                        line2017: { 
                            type: 'line', xMin: 47, xMax: 47, borderColor: '#7f8c8d', borderWidth: 1, borderDash: [2, 2],
                            label: { display: true, content: 'âš¡ çµæ§‹äº¤å‰(è€>å¹¼)', position: 'end', backgroundColor: 'rgba(0,0,0,0.7)', font: {size: 10}, yAdjust: 30 }
                        },
                        // 6. ç”Ÿæ­»äº¤å‰é» (æ­»>ç”Ÿ)
                        line2020: {
                            type: 'line', xMin: 50, xMax: 50, borderColor: '#c0392b', borderWidth: 2,
                            label: { display: true, content: 'ğŸ’€ ç”Ÿæ­»äº¤å‰', position: 'center', backgroundColor: '#c0392b', color:'white', font:{size:11, weight:'bold'}, yAdjust: -10 }
                        },

                        // 7. 2025 æ‰¶è€å£“åŠ›
                        label2025Old: { type: 'label', xValue: 55, yValue: 32, content: ['åƒ… 3.4äºº','é¤Š1è€äºº'], color: '#d35400', font: {size: 11, weight: 'bold'}, xAdjust: -35 },
                        // 8. 2025 æ‰¶å¹¼å£“åŠ›
                        label2025Young: { type: 'label', xValue: 55, yValue: 16, content: ['6.1äºº','é¤Š1å°å­©'], color: '#27ae60', font: {size: 10, weight: 'bold'}, xAdjust: -30 }
                    }
                }
            },
            scales: {
                x: { ticks: { maxTicksLimit: 12 } },
                y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'äºº\næ•¸\nï¼ˆ\näºº\nï¼‰', color: '#555', font: {lineHeight: 1.4} }, grid: { color: '#f0f0f0' } },
                y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'æ¯”\nç‡\nï¼ˆ\n%\nï¼‰', color: '#9b59b6', font: {lineHeight: 1.4} }, grid: { drawOnChartArea: false }, min: 0, max: 80 },
                y2: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'ç¸½\näºº\nå£\nï¼ˆ\nè¬\nï¼‰', color: '#f39c12', font: {lineHeight: 1.4} }, grid: { drawOnChartArea: false }, min: 1400, max: 2500 }
            }
        }
    });

    const tableBody = document.querySelector('#dataTable tbody');
    rawTableData.forEach(d => {
        const tr = document.createElement('tr');
        if(d.zodiac==='é¾') tr.classList.add('dragon-row');
        
        let pressureClass = 'pressure-mid';
        const ratio = parseFloat(d.support);
        if (ratio >= 2.5) pressureClass = 'pressure-low';
        if (ratio < 2.2) pressureClass = 'pressure-high';

        tr.innerHTML = `
            <td><span class="zodiac-icon">${d.icon}</span>${d.year} <small>${d.zodiac}</small></td>
            <td>${new Intl.NumberFormat('zh-TW').format(d.birth)}</td>
            <td>${new Intl.NumberFormat('zh-TW').format(d.death)}</td>
            <td style="font-weight:bold; color:#f39c12">${d.pop}</td>
            <td class="${d.diff<0?'negative-val':''}" style="color:${d.diff>0?'#27ae60':''}">
                ${d.diff>0?'+':''}${new Intl.NumberFormat('zh-TW').format(d.diff)}
            </td>
            <td style="color:#2ecc71">${d.depY}</td>
            <td style="color:#d35400">${d.depO}</td>
            <td style="font-weight:bold; color:#9b59b6">${d.depT}</td>
            <td><span class="pressure-tag ${pressureClass}">${d.support}äºº é¤Š 1äºº</span></td>
        `;
        tableBody.appendChild(tr);
    });

    function toggleDataset(index, checkbox) {
        const isVisible = checkbox.checked;
        chart.setDatasetVisibility(index, isVisible);
        const btn = checkbox.parentElement;
        isVisible ? btn.classList.add('active') : btn.classList.remove('active');

        // é€£å‹•æ¨™ç±¤
        const ants = chart.options.plugins.annotation.annotations;
        if(index === 0 || index === 1) { // å‡ºç”Ÿ/æ­»äº¡ -> ç”Ÿæ­»äº¤å‰
            // åªæœ‰ç•¶å…©è€…éƒ½é–‹å•Ÿæ™‚æ‰é¡¯ç¤ºç”Ÿæ­»äº¤å‰ (ç‚ºäº†é¿å…èª¤å°)
            // ä½†ç‚ºäº†ç°¡åŒ–æ“ä½œï¼Œä»»ä¸€é–‹å•Ÿå°±é¡¯ç¤ºä¹Ÿå¯ä»¥ï¼Œé€™è£¡è¨­å®šè·Ÿéš¨"æ­»äº¡"é–‹é—œ
            if(index === 1 && ants.line2020) ants.line2020.display = isVisible;
        }
        if(index === 3) { // æ‰¶å¹¼æ¯”
            if(ants.label2025Young) ants.label2025Young.display = isVisible;
        }
        if(index === 4) { // æ‰¶è€æ¯” (é€£å‹•è€åŒ–é‡Œç¨‹ç¢‘ & çµæ§‹äº¤å‰)
            if(ants.label2025Old) ants.label2025Old.display = isVisible;
            if(ants.milestone1993) ants.milestone1993.display = isVisible;
            if(ants.milestone2018) ants.milestone2018.display = isVisible;
            if(ants.milestone2025) ants.milestone2025.display = isVisible;
            if(ants.line2017) ants.line2017.display = isVisible; // çµæ§‹äº¤å‰ä¹Ÿè·Ÿè‘—æ‰¶è€æ¯”é¡¯ç¤º
        }
        if(index === 5) { // ç¸½äººå£
             if(ants.line2015) ants.line2015.display = isVisible;
        }

        chart.update();
    }
</script>

</body>
</html>